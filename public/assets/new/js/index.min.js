( function(){

    $( function(){

        $.each( $( '.promo__form' ), function() {
            new FormValidation ( $( this ) );
        } );

        $.each( $( '.form__wrap' ), function() {
            new FormValidation ( $( this ) );
        } );

        $.each( $( '.popup__form' ), function() {
            new FormValidation ( $( this ) );
        } );

    });

    var FormValidation = function (obj) {
        var _obj = obj,
            _inputs = _obj.find( $( '[required]' ) );

        var _addEvents = function () {

                _obj.on( {
                    'submit': function(){

                        $.each( _inputs, function(){

                            var curItem = $( this ),
                                curType = curItem.attr( 'type' );

                            if ( curItem.val() == '' ) {

                                curItem.addClass( 'novalid' );
                                _obj.addClass( 'error' );

                            }
                            else if ( curType == 'email' ){

                                var pattern = /^([a-z0-9_\.-])+@[a-z0-9-]+\.([a-z]{2,4}\.)?[a-z]{2,4}$/i;

                                if ( pattern.test( curItem.val() ) == false ){

                                    curItem.addClass( 'novalid' );
                                    _obj.addClass( 'error' );

                                }

                            }
                            else if ( curType == 'url' ){
                                var pattern = /^([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/;

                                if ( pattern.test( curItem.val() ) == false ){

                                    curItem.addClass( 'novalid' );
                                    _obj.addClass( 'error' );

                                }

                            }

                        } );

                        if( _obj.hasClass( 'error' ) ){
                            return false;
                        }
                        else {

                            if ( _obj.hasClass( 'promo__form' ) ) {

                                $( '.promo__form' )[ 0 ].obj.link();
                                return false;

                            }

                            if ( _obj.hasClass( 'form__wrap' ) ) {

                                $( '.form' )[ 0 ].obj.send();
                                return false;

                            }

                            if ( _obj.hasClass( 'popup__form' ) ) {

                                $( '.popup__form' )[ 0 ].obj.send();
                                return false;

                            }

                        }

                    }
                } );

                _inputs.on( {
                    'focus': function ()  {

                        var curItem = $( this ),
                            closest = curItem.closest( 'fieldset' ),
                            innerInputs = closest.find( 'input' );

                        $( this ).removeClass( 'novalid' );

                        if( _obj.hasClass( 'error' ) ){
                            curItem.addClass( 'valid' );
                            curItem.removeClass( 'novalid' );

                            if ( innerInputs.length > 1 ){
                                if ( !closest.find( '.novalid' ).length ){
                                    closest.removeClass( 'error' );
                                }
                            } else {
                                _obj.removeClass( 'error' );
                            }
                        }

                    }
                } );

            },
            _init = function () {
                _addEvents();
            };

        _init();
    };

} )();
( function(){

    $( function(){

        $( '.popup' ).each(function(){

            new Popup($(this));

        });

    });

    var Popup = function( obj ){

        //private properties
        var _self = this,
            _popupPadding = 40,
            _btnShow =  $( '.popup__open' ),
            _obj = obj,
            _btnClose = _obj.find( '.popup__close, .popup__cancel' ),
            _wrap = _obj.find( '.popup__wrap' ),
            _contents = _obj.find( '.popup__content' ),
            _scrollConteiner = $( 'html' ),
            _window = $( window ),
            _timer = setTimeout( function(){}, 1 );

        //private methods
        var _centerWrap = function(){
                if ( _window.height() - ( _popupPadding * 2 ) - _wrap.height() > 0 ) {
                    _wrap.css( { top: ( ( _window.height() - ( _popupPadding * 2 ) ) - _wrap.height() ) / 2 } );
                } else {
                    _wrap.css( { top: 0 } );
                }
            },
            _getScrollWidth = function (){
                var scrollDiv = document.createElement( 'div'),
                    scrollBarWidth;

                scrollDiv.className = 'popup__scrollbar-measure';

                document.body.appendChild( scrollDiv );

                scrollBarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;

                document.body.removeChild(scrollDiv);

                return scrollBarWidth;
            },
            _hide = function(){
                _obj.css( {
                    overflowY: 'hidden'
                } );
                _scrollConteiner.css( {
                    overflowY: 'auto',
                    paddingRight: 0
                } );

                _obj.removeClass( 'popup_opened' );
                _obj.addClass( 'popup_hide' );

                _timer = setTimeout( function(){

                    _obj.css ({
                        overflowY: 'auto'
                    });

                    _obj.removeClass( 'popup_hide' );
                }, 300 );

            },
            _init = function(){
                _obj[ 0 ].obj = _self;
                _onEvents();
            },
            _onEvents = function(){
                _window.on( {
                    resize: function(){
                        _centerWrap();
                    }
                } );
                _btnShow.on( {
                    click: function(){
                        _show( $( this ).attr( 'data-popup' ) );
                        return false;
                    }
                } );
                _wrap.on( {
                    click: function( e ){
                        e.stopPropagation();
                    }
                } );
                _obj.on( {
                    click: function(){
                        _hide();
                        return false;
                    }
                } );
                _btnClose.on( {
                    click: function(){
                        _hide();
                        return false;
                    }
                } );
            },
            _show = function( className ){
                _setPopupContent( className );

                _scrollConteiner.css( {
                    overflowY: 'hidden',
                    paddingRight: _getScrollWidth()
                } );
                _obj.addClass( 'popup_opened' );
                _centerWrap();

            },
            _setPopupContent = function( className ){
                var curContent = _contents.filter( '.popup__' + className );

                _contents.css( { display: 'none' } );
                curContent.css( { display: 'block' } );
            };

        //public properties

        //public methods
        _self.show = function ( e ) {
            _show( e );
        };
        _self.hide = function () {
            _hide();
        };

        _init();
    };

} )();


( function(){

    $( function(){

        $( '.mobile-menu' ).each( function(){
            new Menu( $( this ) );
        } );

        $( '.language' ).each( function(){
            new Language( $( this ) );
        } );

        $( '.promo__form' ).each( function(){
            new Promo( $( this ) );
        } );

        $( '.form' ).each( function(){
            new SendForm( $( this ) );
        } );

        $( '.popup__form' ).each( function(){
            new SendPopupForm( $( this ) );
        } );

    } );

    var Menu = function( obj ){

        //private properties
        var _obj = obj,
            _btn = $( '.mobile-menu-btn' );

        //private methods
        var _constructor = function(){
                _onEvents();
            },
            _onEvents = function(){

                _btn.on( 'click', function() {

                    if ( $( this).hasClass( 'close' ) ){
                        _closeMenu();
                    } else {
                        _openMenu();
                    }

                } );

            },
            _openMenu = function(){
                _btn.addClass( 'close' );
                _obj.addClass( 'visible' );
            },
            _closeMenu = function(){
                _btn.removeClass( 'close' );
                _obj.removeClass( 'visible' );
            };

        //public properties

        //public methods

        _constructor();

    };

    var Language = function( obj ){

        //private properties
        var _obj = obj,
            _btn = _obj.find( '.language__active'),
            _popup = _obj.find( '.language__popup'),
            _window = $( window );

        //private methods
        var _constructor = function(){
                _onEvents();
            },
            _onEvents = function(){

                _window.on( 'click', function() {
                    _closePopup();
                } );

                _obj.on( 'click', function( e ) {
                    e.stopPropagation( e );
                } );

                _btn.on( 'click', function() {

                    if ( _popup.hasClass( 'visible' ) ) {
                        _closePopup();
                    } else {
                        _openPopup();
                    }

                } );

            },
            _openPopup = function(){
                _popup.addClass( 'visible' );
            },
            _closePopup = function(){
                _popup.removeClass( 'visible' );
            };

        //public properties

        //public methods

        _constructor();

    };

    var Promo = function( obj ){

        //private properties
        var _obj = obj,
            _self = this,
            _input = _obj.find( 'input' );

        //private methods
        var _constructor = function(){
                _obj[ 0 ].obj = _self;
            },
            _openPopup = function(){

                var _site = _input.val(),
                    _popupTitle = $( '#popup__content-title' );


                _popupTitle.html( _site );

                $( '.popup' )[ 0 ].obj.show( 'order' );

            };

        //public properties

        //public methods
        _self.link = function () {
            _openPopup();
        };

        _constructor();

    };

    // форма фидбэка
    var SendForm = function( obj ){

        //private properties
        var _obj = obj,
            _self = this,
            _thanks = _obj.find( '.form__thanks'),
            _sendMore = _obj.find( '.form__more'),
            _inputs = _obj.find( 'input'),
            _textarea = _obj.find( 'textarea' );

        //private methods
        var _constructor = function(){
                _obj[ 0 ].obj = _self;
                _onEvent();
            },
            _onEvent = function(){

                _sendMore.on( 'click', function() {
                    _thanks.removeClass( 'visible' );
                    _inputs.val('');
                    _textarea.val('');
                    return false;
                } )

            },
            _ajaxSend = function(){

                $.ajax({
                    url: '/send-feedback',
                    dataType: 'html',
                    timeout: 20000,
                    type: "GET",
                    data: {
                        form: 'true',
                        name: $('#form__name').val(),
                        email: $('#form__email').val(),
                        phone: $('#form__phone').val(),
                        text: $('#form__message').val()
                    },
                    success: function () {
                        _thankful();
                    },
                    error: function (XMLHttpRequest) {
                        if (XMLHttpRequest.statusText != 'abort') {
                            alert(XMLHttpRequest.statusText);
                        }
                    }
                });
                return false;

            },
            _thankful = function(){
                _thanks.addClass( 'visible' );
            };

        //public properties

        //public methods
        _self.send = function () {
            _ajaxSend();
        };

        _constructor();

    };

    // Добавление сайта на просчет
    var SendPopupForm = function( obj ){

        //private properties
        var _obj = obj,
            _self = this,
            _thanks = _obj.find( '.form__thanks'),
            _sendMore = _obj.find( '.form__more'),
            _inputs = _obj.find( 'input'),
            _textarea = _obj.find( 'textarea' );

        //private methods
        var _constructor = function(){
                _obj[ 0 ].obj = _self;
                _onEvent();
            },
            _onEvent = function(){

                _sendMore.on( 'click', function() {
                    _thanks.removeClass( 'visible' );
                    _inputs.val('');
                    _textarea.val('');
                    return false;
                } )

            },
            _ajaxSend = function(){

                $.ajax({
                    url: '/add-site-unreg',
                    dataType: 'html',
                    timeout: 20000,
                    type: "GET",
                    data: {
                        popupform: 'true',
                        name: $('#popup__name').val(),
                        email: $('#popup__email').val(),
                        phone: $('#popup__phone').val(),
                        url: $('#form__url').val()
                    },
                    success: function () {
                        $( '.popup' )[ 0 ].obj.show( 'thanks' );

                        setTimeout( function() {
                            $( '.popup' )[ 0 ].obj.hide( 'thanks' );
                        }, 3000 );

                    },
                    error: function (XMLHttpRequest) {
                        if (XMLHttpRequest.statusText != 'abort') {
                            alert(XMLHttpRequest.statusText);
                        }
                    }
                });
                return false;

            },
            _thankful = function(){
                _thanks.addClass( 'visible' );
            };

        //public properties

        //public methods
        _self.send = function () {
            _ajaxSend();
        };

        _constructor();

    };

} )();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5mb3JtLnZhbGlkYXRvci5qcyIsImpxdWVyeS5wb3B1cC5qcyIsImpxdWVyeS5pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeklBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImluZGV4Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiggZnVuY3Rpb24oKXtcblxuICAgICQoIGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgJC5lYWNoKCAkKCAnLnByb21vX19mb3JtJyApLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG5ldyBGb3JtVmFsaWRhdGlvbiAoICQoIHRoaXMgKSApO1xuICAgICAgICB9ICk7XG5cbiAgICAgICAgJC5lYWNoKCAkKCAnLmZvcm1fX3dyYXAnICksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmV3IEZvcm1WYWxpZGF0aW9uICggJCggdGhpcyApICk7XG4gICAgICAgIH0gKTtcblxuICAgICAgICAkLmVhY2goICQoICcucG9wdXBfX2Zvcm0nICksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmV3IEZvcm1WYWxpZGF0aW9uICggJCggdGhpcyApICk7XG4gICAgICAgIH0gKTtcblxuICAgIH0pO1xuXG4gICAgdmFyIEZvcm1WYWxpZGF0aW9uID0gZnVuY3Rpb24gKG9iaikge1xuICAgICAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgICAgIF9pbnB1dHMgPSBfb2JqLmZpbmQoICQoICdbcmVxdWlyZWRdJyApICk7XG5cbiAgICAgICAgdmFyIF9hZGRFdmVudHMgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICBfb2JqLm9uKCB7XG4gICAgICAgICAgICAgICAgICAgICdzdWJtaXQnOiBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goIF9pbnB1dHMsIGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VySXRlbSA9ICQoIHRoaXMgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyVHlwZSA9IGN1ckl0ZW0uYXR0ciggJ3R5cGUnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGN1ckl0ZW0udmFsKCkgPT0gJycgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VySXRlbS5hZGRDbGFzcyggJ25vdmFsaWQnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9vYmouYWRkQ2xhc3MoICdlcnJvcicgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICggY3VyVHlwZSA9PSAnZW1haWwnICl7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSAvXihbYS16MC05X1xcLi1dKStAW2EtejAtOS1dK1xcLihbYS16XXsyLDR9XFwuKT9bYS16XXsyLDR9JC9pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcGF0dGVybi50ZXN0KCBjdXJJdGVtLnZhbCgpICkgPT0gZmFsc2UgKXtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VySXRlbS5hZGRDbGFzcyggJ25vdmFsaWQnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb2JqLmFkZENsYXNzKCAnZXJyb3InICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCBjdXJUeXBlID09ICd1cmwnICl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXR0ZXJuID0gL14oW1xcZGEtelxcLi1dKylcXC4oW2EtelxcLl17Miw2fSkoW1xcL1xcdyBcXC4tXSopKlxcLz8kLztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHBhdHRlcm4udGVzdCggY3VySXRlbS52YWwoKSApID09IGZhbHNlICl7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1ckl0ZW0uYWRkQ2xhc3MoICdub3ZhbGlkJyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX29iai5hZGRDbGFzcyggJ2Vycm9yJyApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiggX29iai5oYXNDbGFzcyggJ2Vycm9yJyApICl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIF9vYmouaGFzQ2xhc3MoICdwcm9tb19fZm9ybScgKSApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCAnLnByb21vX19mb3JtJyApWyAwIF0ub2JqLmxpbmsoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBfb2JqLmhhc0NsYXNzKCAnZm9ybV9fd3JhcCcgKSApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCAnLmZvcm0nIClbIDAgXS5vYmouc2VuZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIF9vYmouaGFzQ2xhc3MoICdwb3B1cF9fZm9ybScgKSApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCAnLnBvcHVwX19mb3JtJyApWyAwIF0ub2JqLnNlbmQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgIF9pbnB1dHMub24oIHtcbiAgICAgICAgICAgICAgICAgICAgJ2ZvY3VzJzogZnVuY3Rpb24gKCkgIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1ckl0ZW0gPSAkKCB0aGlzICksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VzdCA9IGN1ckl0ZW0uY2xvc2VzdCggJ2ZpZWxkc2V0JyApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlubmVySW5wdXRzID0gY2xvc2VzdC5maW5kKCAnaW5wdXQnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICQoIHRoaXMgKS5yZW1vdmVDbGFzcyggJ25vdmFsaWQnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCBfb2JqLmhhc0NsYXNzKCAnZXJyb3InICkgKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJJdGVtLmFkZENsYXNzKCAndmFsaWQnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VySXRlbS5yZW1vdmVDbGFzcyggJ25vdmFsaWQnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGlubmVySW5wdXRzLmxlbmd0aCA+IDEgKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhY2xvc2VzdC5maW5kKCAnLm5vdmFsaWQnICkubGVuZ3RoICl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZXN0LnJlbW92ZUNsYXNzKCAnZXJyb3InICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb2JqLnJlbW92ZUNsYXNzKCAnZXJyb3InICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfYWRkRXZlbnRzKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIF9pbml0KCk7XG4gICAgfTtcblxufSApKCk7IiwiKCBmdW5jdGlvbigpe1xuXG4gICAgJCggZnVuY3Rpb24oKXtcblxuICAgICAgICAkKCAnLnBvcHVwJyApLmVhY2goZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgbmV3IFBvcHVwKCQodGhpcykpO1xuXG4gICAgICAgIH0pO1xuXG4gICAgfSk7XG5cbiAgICB2YXIgUG9wdXAgPSBmdW5jdGlvbiggb2JqICl7XG5cbiAgICAgICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICAgICAgdmFyIF9zZWxmID0gdGhpcyxcbiAgICAgICAgICAgIF9wb3B1cFBhZGRpbmcgPSA0MCxcbiAgICAgICAgICAgIF9idG5TaG93ID0gICQoICcucG9wdXBfX29wZW4nICksXG4gICAgICAgICAgICBfb2JqID0gb2JqLFxuICAgICAgICAgICAgX2J0bkNsb3NlID0gX29iai5maW5kKCAnLnBvcHVwX19jbG9zZSwgLnBvcHVwX19jYW5jZWwnICksXG4gICAgICAgICAgICBfd3JhcCA9IF9vYmouZmluZCggJy5wb3B1cF9fd3JhcCcgKSxcbiAgICAgICAgICAgIF9jb250ZW50cyA9IF9vYmouZmluZCggJy5wb3B1cF9fY29udGVudCcgKSxcbiAgICAgICAgICAgIF9zY3JvbGxDb250ZWluZXIgPSAkKCAnaHRtbCcgKSxcbiAgICAgICAgICAgIF93aW5kb3cgPSAkKCB3aW5kb3cgKSxcbiAgICAgICAgICAgIF90aW1lciA9IHNldFRpbWVvdXQoIGZ1bmN0aW9uKCl7fSwgMSApO1xuXG4gICAgICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIHZhciBfY2VudGVyV3JhcCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKCBfd2luZG93LmhlaWdodCgpIC0gKCBfcG9wdXBQYWRkaW5nICogMiApIC0gX3dyYXAuaGVpZ2h0KCkgPiAwICkge1xuICAgICAgICAgICAgICAgICAgICBfd3JhcC5jc3MoIHsgdG9wOiAoICggX3dpbmRvdy5oZWlnaHQoKSAtICggX3BvcHVwUGFkZGluZyAqIDIgKSApIC0gX3dyYXAuaGVpZ2h0KCkgKSAvIDIgfSApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIF93cmFwLmNzcyggeyB0b3A6IDAgfSApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0U2Nyb2xsV2lkdGggPSBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicpLFxuICAgICAgICAgICAgICAgICAgICBzY3JvbGxCYXJXaWR0aDtcblxuICAgICAgICAgICAgICAgIHNjcm9sbERpdi5jbGFzc05hbWUgPSAncG9wdXBfX3Njcm9sbGJhci1tZWFzdXJlJztcblxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoIHNjcm9sbERpdiApO1xuXG4gICAgICAgICAgICAgICAgc2Nyb2xsQmFyV2lkdGggPSBzY3JvbGxEaXYub2Zmc2V0V2lkdGggLSBzY3JvbGxEaXYuY2xpZW50V2lkdGg7XG5cbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHNjcm9sbERpdik7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gc2Nyb2xsQmFyV2lkdGg7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2hpZGUgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIF9vYmouY3NzKCB7XG4gICAgICAgICAgICAgICAgICAgIG92ZXJmbG93WTogJ2hpZGRlbidcbiAgICAgICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICAgICAgX3Njcm9sbENvbnRlaW5lci5jc3MoIHtcbiAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3dZOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgICAgIHBhZGRpbmdSaWdodDogMFxuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgIF9vYmoucmVtb3ZlQ2xhc3MoICdwb3B1cF9vcGVuZWQnICk7XG4gICAgICAgICAgICAgICAgX29iai5hZGRDbGFzcyggJ3BvcHVwX2hpZGUnICk7XG5cbiAgICAgICAgICAgICAgICBfdGltZXIgPSBzZXRUaW1lb3V0KCBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgICAgIF9vYmouY3NzICh7XG4gICAgICAgICAgICAgICAgICAgICAgICBvdmVyZmxvd1k6ICdhdXRvJ1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBfb2JqLnJlbW92ZUNsYXNzKCAncG9wdXBfaGlkZScgKTtcbiAgICAgICAgICAgICAgICB9LCAzMDAgKTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9pbml0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBfb2JqWyAwIF0ub2JqID0gX3NlbGY7XG4gICAgICAgICAgICAgICAgX29uRXZlbnRzKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uRXZlbnRzID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBfd2luZG93Lm9uKCB7XG4gICAgICAgICAgICAgICAgICAgIHJlc2l6ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9jZW50ZXJXcmFwKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICAgICAgX2J0blNob3cub24oIHtcbiAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBfc2hvdyggJCggdGhpcyApLmF0dHIoICdkYXRhLXBvcHVwJyApICk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICAgICAgX3dyYXAub24oIHtcbiAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uKCBlICl7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSApO1xuICAgICAgICAgICAgICAgIF9vYmoub24oIHtcbiAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBfaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSApO1xuICAgICAgICAgICAgICAgIF9idG5DbG9zZS5vbigge1xuICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3Nob3cgPSBmdW5jdGlvbiggY2xhc3NOYW1lICl7XG4gICAgICAgICAgICAgICAgX3NldFBvcHVwQ29udGVudCggY2xhc3NOYW1lICk7XG5cbiAgICAgICAgICAgICAgICBfc2Nyb2xsQ29udGVpbmVyLmNzcygge1xuICAgICAgICAgICAgICAgICAgICBvdmVyZmxvd1k6ICdoaWRkZW4nLFxuICAgICAgICAgICAgICAgICAgICBwYWRkaW5nUmlnaHQ6IF9nZXRTY3JvbGxXaWR0aCgpXG4gICAgICAgICAgICAgICAgfSApO1xuICAgICAgICAgICAgICAgIF9vYmouYWRkQ2xhc3MoICdwb3B1cF9vcGVuZWQnICk7XG4gICAgICAgICAgICAgICAgX2NlbnRlcldyYXAoKTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zZXRQb3B1cENvbnRlbnQgPSBmdW5jdGlvbiggY2xhc3NOYW1lICl7XG4gICAgICAgICAgICAgICAgdmFyIGN1ckNvbnRlbnQgPSBfY29udGVudHMuZmlsdGVyKCAnLnBvcHVwX18nICsgY2xhc3NOYW1lICk7XG5cbiAgICAgICAgICAgICAgICBfY29udGVudHMuY3NzKCB7IGRpc3BsYXk6ICdub25lJyB9ICk7XG4gICAgICAgICAgICAgICAgY3VyQ29udGVudC5jc3MoIHsgZGlzcGxheTogJ2Jsb2NrJyB9ICk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIC8vcHVibGljIHByb3BlcnRpZXNcblxuICAgICAgICAvL3B1YmxpYyBtZXRob2RzXG4gICAgICAgIF9zZWxmLnNob3cgPSBmdW5jdGlvbiAoIGUgKSB7XG4gICAgICAgICAgICBfc2hvdyggZSApO1xuICAgICAgICB9O1xuICAgICAgICBfc2VsZi5oaWRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX2hpZGUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBfaW5pdCgpO1xuICAgIH07XG5cbn0gKSgpO1xuXG4iLCIoIGZ1bmN0aW9uKCl7XG5cbiAgICAkKCBmdW5jdGlvbigpe1xuXG4gICAgICAgICQoICcubW9iaWxlLW1lbnUnICkuZWFjaCggZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIG5ldyBNZW51KCAkKCB0aGlzICkgKTtcbiAgICAgICAgfSApO1xuXG4gICAgICAgICQoICcubGFuZ3VhZ2UnICkuZWFjaCggZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIG5ldyBMYW5ndWFnZSggJCggdGhpcyApICk7XG4gICAgICAgIH0gKTtcblxuICAgICAgICAkKCAnLnByb21vX19mb3JtJyApLmVhY2goIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBuZXcgUHJvbW8oICQoIHRoaXMgKSApO1xuICAgICAgICB9ICk7XG5cbiAgICAgICAgJCggJy5mb3JtJyApLmVhY2goIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBuZXcgU2VuZEZvcm0oICQoIHRoaXMgKSApO1xuICAgICAgICB9ICk7XG5cbiAgICAgICAgJCggJy5wb3B1cF9fZm9ybScgKS5lYWNoKCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgbmV3IFNlbmRQb3B1cEZvcm0oICQoIHRoaXMgKSApO1xuICAgICAgICB9ICk7XG5cbiAgICB9ICk7XG5cbiAgICB2YXIgTWVudSA9IGZ1bmN0aW9uKCBvYmogKXtcblxuICAgICAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgICAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgICAgIF9idG4gPSAkKCAnLm1vYmlsZS1tZW51LWJ0bicgKTtcblxuICAgICAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgICAgICB2YXIgX2NvbnN0cnVjdG9yID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBfb25FdmVudHMoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25FdmVudHMgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgX2J0bi5vbiggJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCAkKCB0aGlzKS5oYXNDbGFzcyggJ2Nsb3NlJyApICl7XG4gICAgICAgICAgICAgICAgICAgICAgICBfY2xvc2VNZW51KCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfb3Blbk1lbnUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29wZW5NZW51ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBfYnRuLmFkZENsYXNzKCAnY2xvc2UnICk7XG4gICAgICAgICAgICAgICAgX29iai5hZGRDbGFzcyggJ3Zpc2libGUnICk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2Nsb3NlTWVudSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgX2J0bi5yZW1vdmVDbGFzcyggJ2Nsb3NlJyApO1xuICAgICAgICAgICAgICAgIF9vYmoucmVtb3ZlQ2xhc3MoICd2aXNpYmxlJyApO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBwcm9wZXJ0aWVzXG5cbiAgICAgICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgICAgIF9jb25zdHJ1Y3RvcigpO1xuXG4gICAgfTtcblxuICAgIHZhciBMYW5ndWFnZSA9IGZ1bmN0aW9uKCBvYmogKXtcblxuICAgICAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgICAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgICAgIF9idG4gPSBfb2JqLmZpbmQoICcubGFuZ3VhZ2VfX2FjdGl2ZScpLFxuICAgICAgICAgICAgX3BvcHVwID0gX29iai5maW5kKCAnLmxhbmd1YWdlX19wb3B1cCcpLFxuICAgICAgICAgICAgX3dpbmRvdyA9ICQoIHdpbmRvdyApO1xuXG4gICAgICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIHZhciBfY29uc3RydWN0b3IgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIF9vbkV2ZW50cygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkV2ZW50cyA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgICAgICBfd2luZG93Lm9uKCAnY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgX2Nsb3NlUG9wdXAoKTtcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICBfb2JqLm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHtcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oIGUgKTtcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICBfYnRuLm9uKCAnY2xpY2snLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIF9wb3B1cC5oYXNDbGFzcyggJ3Zpc2libGUnICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfY2xvc2VQb3B1cCgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgX29wZW5Qb3B1cCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb3BlblBvcHVwID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBfcG9wdXAuYWRkQ2xhc3MoICd2aXNpYmxlJyApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jbG9zZVBvcHVwID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBfcG9wdXAucmVtb3ZlQ2xhc3MoICd2aXNpYmxlJyApO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBwcm9wZXJ0aWVzXG5cbiAgICAgICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgICAgIF9jb25zdHJ1Y3RvcigpO1xuXG4gICAgfTtcblxuICAgIHZhciBQcm9tbyA9IGZ1bmN0aW9uKCBvYmogKXtcblxuICAgICAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgICAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgICAgIF9zZWxmID0gdGhpcyxcbiAgICAgICAgICAgIF9pbnB1dCA9IF9vYmouZmluZCggJ2lucHV0JyApO1xuXG4gICAgICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIHZhciBfY29uc3RydWN0b3IgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIF9vYmpbIDAgXS5vYmogPSBfc2VsZjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb3BlblBvcHVwID0gZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgIHZhciBfc2l0ZSA9IF9pbnB1dC52YWwoKSxcbiAgICAgICAgICAgICAgICAgICAgX3BvcHVwVGl0bGUgPSAkKCAnI3BvcHVwX19jb250ZW50LXRpdGxlJyApO1xuXG5cbiAgICAgICAgICAgICAgICBfcG9wdXBUaXRsZS5odG1sKCBfc2l0ZSApO1xuXG4gICAgICAgICAgICAgICAgJCggJy5wb3B1cCcgKVsgMCBdLm9iai5zaG93KCAnb3JkZXInICk7XG5cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgICAgIC8vcHVibGljIG1ldGhvZHNcbiAgICAgICAgX3NlbGYubGluayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF9vcGVuUG9wdXAoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBfY29uc3RydWN0b3IoKTtcblxuICAgIH07XG5cbiAgICB2YXIgU2VuZEZvcm0gPSBmdW5jdGlvbiggb2JqICl7XG5cbiAgICAgICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICAgICAgdmFyIF9vYmogPSBvYmosXG4gICAgICAgICAgICBfc2VsZiA9IHRoaXMsXG4gICAgICAgICAgICBfdGhhbmtzID0gX29iai5maW5kKCAnLmZvcm1fX3RoYW5rcycpLFxuICAgICAgICAgICAgX3NlbmRNb3JlID0gX29iai5maW5kKCAnLmZvcm1fX21vcmUnKSxcbiAgICAgICAgICAgIF9pbnB1dHMgPSBfb2JqLmZpbmQoICdpbnB1dCcpLFxuICAgICAgICAgICAgX3RleHRhcmVhID0gX29iai5maW5kKCAndGV4dGFyZWEnICk7XG5cbiAgICAgICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICAgICAgdmFyIF9jb25zdHJ1Y3RvciA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgX29ialsgMCBdLm9iaiA9IF9zZWxmO1xuICAgICAgICAgICAgICAgIF9vbkV2ZW50KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uRXZlbnQgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgX3NlbmRNb3JlLm9uKCAnY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoYW5rcy5yZW1vdmVDbGFzcyggJ3Zpc2libGUnICk7XG4gICAgICAgICAgICAgICAgICAgIF9pbnB1dHMudmFsKCcnKTtcbiAgICAgICAgICAgICAgICAgICAgX3RleHRhcmVhLnZhbCgnJyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IClcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9hamF4U2VuZCA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICdwaHAvZm9ybS5waHAnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2h0bWwnLFxuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiAyMDAwMCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJHRVRcIixcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybTogJ3RydWUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJCgnI2Zvcm1fX25hbWUnKS52YWwoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiAkKCcjZm9ybV9fZW1haWwnKS52YWwoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBob25lOiAkKCcjZm9ybV9fcGhvbmUnKS52YWwoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICQoJyNmb3JtX19tZXNzYWdlJykudmFsKClcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoYW5rZnVsKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoWE1MSHR0cFJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChYTUxIdHRwUmVxdWVzdC5zdGF0dXNUZXh0ICE9ICdhYm9ydCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChYTUxIdHRwUmVxdWVzdC5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF90aGFua2Z1bCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgX3RoYW5rcy5hZGRDbGFzcyggJ3Zpc2libGUnICk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIC8vcHVibGljIHByb3BlcnRpZXNcblxuICAgICAgICAvL3B1YmxpYyBtZXRob2RzXG4gICAgICAgIF9zZWxmLnNlbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfYWpheFNlbmQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBfY29uc3RydWN0b3IoKTtcblxuICAgIH07XG5cbiAgICB2YXIgU2VuZFBvcHVwRm9ybSA9IGZ1bmN0aW9uKCBvYmogKXtcblxuICAgICAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgICAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgICAgIF9zZWxmID0gdGhpcyxcbiAgICAgICAgICAgIF90aGFua3MgPSBfb2JqLmZpbmQoICcuZm9ybV9fdGhhbmtzJyksXG4gICAgICAgICAgICBfc2VuZE1vcmUgPSBfb2JqLmZpbmQoICcuZm9ybV9fbW9yZScpLFxuICAgICAgICAgICAgX2lucHV0cyA9IF9vYmouZmluZCggJ2lucHV0JyksXG4gICAgICAgICAgICBfdGV4dGFyZWEgPSBfb2JqLmZpbmQoICd0ZXh0YXJlYScgKTtcblxuICAgICAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgICAgICB2YXIgX2NvbnN0cnVjdG9yID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBfb2JqWyAwIF0ub2JqID0gX3NlbGY7XG4gICAgICAgICAgICAgICAgX29uRXZlbnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25FdmVudCA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgICAgICBfc2VuZE1vcmUub24oICdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhhbmtzLnJlbW92ZUNsYXNzKCAndmlzaWJsZScgKTtcbiAgICAgICAgICAgICAgICAgICAgX2lucHV0cy52YWwoJycpO1xuICAgICAgICAgICAgICAgICAgICBfdGV4dGFyZWEudmFsKCcnKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gKVxuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2FqYXhTZW5kID0gZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJ3BocC9mb3JtLnBocCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ6IDIwMDAwLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIkdFVFwiLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3B1cGZvcm06ICd0cnVlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICQoJyNmb3JtX19uYW1lJykudmFsKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogJCgnI2Zvcm1fX2VtYWlsJykudmFsKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBwaG9uZTogJCgnI2Zvcm1fX3Bob25lJykudmFsKCksXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICQoJyNmb3JtX191cmwnKS52YWwoKVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCAnLnBvcHVwJyApWyAwIF0ub2JqLnNob3coICd0aGFua3MnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoICcucG9wdXAnIClbIDAgXS5vYmouaGlkZSggJ3RoYW5rcycgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDMwMDAgKTtcblxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKFhNTEh0dHBSZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCAhPSAnYWJvcnQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfdGhhbmtmdWwgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIF90aGFua3MuYWRkQ2xhc3MoICd2aXNpYmxlJyApO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBwcm9wZXJ0aWVzXG5cbiAgICAgICAgLy9wdWJsaWMgbWV0aG9kc1xuICAgICAgICBfc2VsZi5zZW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX2FqYXhTZW5kKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgX2NvbnN0cnVjdG9yKCk7XG5cbiAgICB9O1xuXG59ICkoKTsiXX0=
